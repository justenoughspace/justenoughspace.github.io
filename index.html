<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Snow Cholera Map - Project 1</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
	<script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
	<style>
		.choleraMap {
			transform: rotate(1.3deg);
			position: relative;
		}

		body {
			font-family: 'Roboto', sans-serif;
		}

		#street {
			stroke: slategray;
			stroke-width: 1.5px;
			fill: none;
		}
		.death {
			stroke: none;
		}

		.death:hover {
			fill: rgb(84, 140, 0);
			r: 7;
		}


		text {
			font-size: 14px;
			font-family: 'Roboto', sans-serif;
		}

		#graph {
			min-width: 400px;
			min-height: 400px;
			/* margin-left: 50px; */
		}

		button {
			height: 40px;
			position: absolute;
			top: 650px;
			width: 100px;
		}

		#button_1 {
			left: 300px;
		}
		#button_2 {
			left: 400px;
		}
		#button_3 {
			left: 500px;
		}

		path {
			fill: #444;
		}

		#mapLegend {
			position: absolute;
			padding: 10px;
			border: 3px solid #444;
			height: 100px;
			width: 120px;
			top: 725px;
			left: 275px;
		}
		#genderLegend {
			position: absolute;
			padding: 10px;
			border: 3px solid #444;
			height: 100px;
			width: 120px;
			top: 725px;
			left: 425px;
		}
		#ageLegend {
			position: absolute;
			padding: 10px;
			border: 3px solid #444;
			height: 150px;
			width: 120px;
			top: 725px;
			left: 575px;
		}
		

	</style>
</head>
<body>
		<h1 style="display:flex; justify-content: center;">John Snow Cholera Map</h1>
		<h2 style="display:flex; justify-content: center;">John Snow Cholera Map</h2>
		<div style="display: flex; justify-content: center;">
		<svg class="choleraMap" height="500" width="500">
		</svg>
		<svg id="graph" width="49%" height="500" width="500">
		</svg>
		<button id="button_1" onClick="showGender()">Show Gender</button>
		<button id="button_2" onClick="displayAge()">Show Ages</button>
		<button id="button_3" onClick="clearStyle()">Clear</button>
		<div id="mapLegend"><strong>Map Legend</strong>
			<li style="color: black; padding-top: 10px;">Pump</li>
			<li style="color: #ff0033;">Death</li>
		</div>
		<div id="genderLegend"><strong>Gender Legend</strong>
			<li style="color: #03c6fc; padding-top: 10px;">Male</li>
			<li style="color: #e703fc;">Female</li>
		</div>
		<div id="ageLegend"><strong>Age Legend</strong>
			<li style="color: #1b9e77; padding-top: 10px;">0-10</li>
			<li style="color: #d95f02;">11-20</li>
			<li style="color: #7570b3;">21-40</li>
			<li style="color: #e7298a;">41-60</li>
			<li style="color: #66a61e">61-80</li>
			<li style="color: #e6ab02;">over 80</li>
			<svg width="600" height="500"></svg>
		</div>
	</div>
		

	
	<script>
		const choleraMap = d3.select(".choleraMap");
		let scaleX = d3.scale.linear();
		let scaleY = d3.scale.linear();
		const MAP_WIDTH = 500;
		const MAP_HEIGHT = 500;
		var deaths = [];
		var deathDays = [];
		let graph = d3.select("svg#graph");
		let graphWidth = 500;
		let graphHeight = 500;
		let padding = 30;
		let graphXScale = d3.scale.linear();
		let graphYScale = d3.scale.linear();
		var createLine = d3.svg.line()
		
		
    var streets = [];
		var pumps = [];
		let ages = [
			{
				age_range: '0-10',
				fill: '#1b9e77'
			},
			{
				age_range: '11-20',
				fill: '#d95f02'
			},
			{
				age_range: '21-40',
				fill: '#7570b3'
			},
			{
				age_range: '41-60',
				fill: '#e7298a'
			},
			{
				age_range: '61-80',
				fill: '#66a61e'
			},
			{
				age_range: '> 80',
				fill: '#e6ab02'
			}
		];
		

		scaleX.domain([3,20]).range([0, MAP_WIDTH]);
		scaleY.domain([3,20]).range([MAP_HEIGHT, 0]);

	//Set up functions that will help create map
		const mapSetup = d3.svg.line()
			.x(function(d) { return scaleX(d.x); })
			.y(function(d) { return scaleY(d.y); })

	//Load deaths data and push the data into the deaths array that will be an object containing x and y values
    d3.csv("deaths_age_sex.csv", function(data) {
      for (let i=0; i < data.length; i++) {
        deaths.push(
          {
            x: data[i].x,
            y: data[i].y,
            age: +data[i].age,
						gender: data[i].gender == 0 ? "male" : "female",
						
          }
        );
      }
  // Load pump data and push it into the empty pump array to be read later in the function putting them on the map    
      });
    d3.csv("pumps.csv", function(data) {
      for (let i=0; i < data.length; i++) {
        pumps.push(
          {
            x: data[i].x,
            y: data[i].y,
            
          }
        );
      }
        
      });

		
	//Load streets data and use a for loop that will leverage map functions to add the streets
		d3.json("streets.json", function(data) {
			streets = data;
			
			for (let i=0; i < streets.length; i++) {
				choleraMap.append("path")
					.attr("d", mapSetup(streets[i]))
					.attr("id", "street");
			}
			addDeathsToMap();
			addPumpsToMap();
		});

	//Add circles to the map representing each death in the death array
    function addDeathsToMap() {
			console.log('death', deathDays)
			choleraMap.selectAll('.death')
				.data(deaths)
				.enter()
				.append('circle')
				.attr('r', 3)
				.attr('id', 'death')
				.attr('class', function(d) {
					return " " +
						"age" + d.age + " " 
				})
				.attr('data-gender', function(d) {
					return "" +
						d.gender + ""
				})
				.attr('fill', '#FF0033')
				.attr('cx', function(d) { return scaleX(d.x); })
				.attr('cy', function(d) { return scaleY(d.y); })
				.on("mouseover", handleMouseOver)
				// .on("mouseout", handleMouseOut)
		}

		d3.json("streets.json", function(data) {
			streets = data;
			
			for (let i=0; i < streets.length; i++) {
				choleraMap.append("path")
					.attr("d", mapSetup(streets[i]))
					.attr("id", "street");
			}
			addDeathsToMap();
			addPumpsToMap();
			drawDeathsGraph()
		});
    
	// //Add pumps
	function addPumpsToMap() {
		choleraMap.selectAll('.pump')
				.data(pumps)
				.enter()
				.append('circle')
				.attr('r', 6)
				.attr('class', 'pump')
				.attr('fill', '#444444')
				.attr('cx', function(d) { return scaleX(d.x); })
				.attr('cy', function(d) { return scaleY(d.y); })
		}

		function handleMouseOver() {
			d3.select("body").append("div")
     .attr("class", "yowza")
		}

		function showGender() {
			choleraMap.selectAll('[data-gender="male"]').attr('fill','#03c6fc');
			choleraMap.selectAll('[data-gender="female"]').attr('fill','#e703fc');
		}

		function clearStyle() {
				choleraMap.selectAll('#death').attr('fill', '#FF0033')
		}

		function displayAge() {
			for (let i=0; i < ages.length; i++) {
				choleraMap.selectAll('.age' + i)
					.attr('fill', ages[i].fill);
			}
		}

//Draw the overall structure of the graph.
function drawDeathsGraphLines() {
				createLine
				.x(function(d) { return graphXScale(d.day); })
				.y(function(d) { return graphYScale(d.total); });

			graph.append('path')
				.attr('d', createLine(deathDays));
			}	

	var svg = d3.select("svg"),
	margin = 200,
	width = svg.attr("width") - margin,
	height = svg.attr("height") - margin
	var xScale = d3.scaleBand().range([0, width]).padding(0.4),
						yScale = d3.scaleLinear().range([height, 0]);

	var g = svg.append("g")
	.attr('transform', "translate(" + 100 + "," + 100 + ")");

	d3.csv("deathDays.csv", function(error, data) {
		if (error) {
			throw error
		}
		xScale.domain(data.map(function(d) {return d.date}));
		yScale.domain([0, d3.max(data, function(d) {return d.deaths})]);

		g.append("g")
		.attr("transform", "translate(0," + height + ")")
		.call(d3.axisBottom(xScale));

		g.append("g")
		.call(d3.axisLeft(yScale).tickFormat(function(d) {
			return d
		}).ticks(10))
	

	g.selectAll(".bar")
	.data(data)
	.enter().append("rect")
	.attr("class", "bar")
	.attr("x", function(d) { return xScale(d.date)})
	.attr("y", function(d) { return yScale(d.value)})
	.attr("width", xScale.bandwidth())
	.attr("height", function(d) {return height - yScale(d.deaths)})
})

// function drawDeathsGraph() {
	

// let xAxis = d3.svg.axis()
// 	.scale(graphXScale)
// 	.orient('bottom')
// 	.tickFormat(function(d) {
// 		return deathDays[d].deathdate;
// 	});

// let yAxis = d3.svg.axis()
// 	.scale(graphYScale)
// 	.orient('left');

// graph.append('g')
// 	.attr('class', 'axis')
// 	.attr('transform', 'translate(0,' + (graphHeight - padding) + ')')
// 	.call(xAxis);

// graph.append('g')
// 	.attr('class', 'axis')
// 	.attr('transform', 'translate(' + padding + ',0)')
// 	.call(yAxis);
// }

// 		d3.csv("deathdays.csv", function(data) {
// 					let deathId = 0;
// 					for (let day = 0; day < data.length; day++) {
					
// 						let totalCount = +data[day].deaths;
// 						let maleCount = 0;
// 						let femaleCount = 0;
// 						let ageCount = [0,0,0,0,0,0];
						
						
						
// 						for (let i=0; i < totalCount; i++) {
// 							// Update the individual death records with the day
// 							// and date of death.
// 							deaths[deathId].deathday = day;
// 							deaths[deathId].deathdate = data[day].date;
							
// 							// Count the deaths on each deathDay by demographic.
// 							if (deaths[deathId].gender == "male") {
// 								maleCount++;
// 							} else {
// 								femaleCount++;
// 							}
// 							ageCount[deaths[deathId].age]++;
							
// 							// Increment to the next individual death record.
// 							deathId++;
// 						}
						
// 						deathDays.push ({
// 							day: day,
// 							deathdate: data[day].date,
// 							total: totalCount,
// 							male: maleCount,
// 							female: femaleCount,
// 							age: ageCount
// 						});
						
// 					}

// 					graphXScale.domain([0, 41])
// 						.range([30, 500]);
// 					graphYScale.domain([0, 160])
// 						.range([475, 10]);
						
// 					addDeathsToMap();
// 					drawDeathsGraphLines();
// 					drawDeathsGraph();
					
// 					// displayTotal();
// 				});

	</script>
</body>


</html>
