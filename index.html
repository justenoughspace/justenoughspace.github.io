
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Snow Cholera Map - Project 1</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
	<script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
	<style>
		.choleraMap {
			transform: rotate(1.3deg);
			position: relative;
		}

		body {
			font-family: 'Roboto', sans-serif;
		}

		#street {
			stroke: slategray;
			stroke-width: 1.5px;
			fill: none;
		}
		.death {
			stroke: none;
		}

		.death:hover {
			fill: rgb(84, 140, 0);
			r: 7;
		}


		text {
			font-size: 14px;
			font-family: 'Roboto', sans-serif;
		}

		#graph {
			min-width: 400px;
			min-height: 400px;
			/* margin-left: 50px; */
		}

		button {
			height: 40px;
			position: absolute;
			top: 750px;
			width: 100px;
		}

		#button_1 {
			left: 300px;
		}
		#button_2 {
			left: 400px;
		}
		#button_3 {
			left: 500px;
		}

		path {
			opacity: 50%;
		}

		#mapLegend {
			position: absolute;
			padding: 10px;
			border: 3px solid #444;
			height: 100px;
			width: 120px;
			top: 800px;
			left: 275px;
		}
		#genderLegend {
			position: absolute;
			padding: 10px;
			border: 3px solid #444;
			height: 100px;
			width: 120px;
			top: 800px;
			left: 425px;
		}
		#ageLegend {
			position: absolute;
			padding: 10px;
			border: 3px solid #444;
			height: 150px;
			width: 120px;
			top: 800px;
			left: 575px;
		}

		.maleLineDeath {
			fill:#03c6fc;
			opacity: 50
		}
		.femaleLineDeath {
			fill:#e703fc;
			opacity: 50%
		}

		.streetName {
			font-size: 10px;
		}

		#soho {
			font-size: 20px;
			font-weight: 800;
		}
		

	</style>
</head>
<body>
	<a href="https://docs.google.com/document/d/1UMVWXcfFVdLccNNJ_wNFj_Uwm1KtAJCDJucJI1dXFHk/edit?usp=sharing">Documentation</a>
		<h1 style="display:flex; justify-content: center; color: #444444">John Snow Cholera Map</h1>
		<h2 style="display:flex; justify-content: center; text-align: center; color: #444444">One of the most important visualizations in history, John Snow's visualization was not only revolutionary <br> in the world of data science, but it also saved lives.
		He did all of this despite not having access to the tools that we have access to today. <br>
		Even with these tools, it will be a rare feat for one to accomplish what Snow did in his time.</h2>
		<div style="display: flex; justify-content: center;">
		<svg class="choleraMap" height="500" width="500">
		</svg>
		<svg class="graph"  height="550" width="500">
		</svg>
		<button id="button_1" onClick="showGender()">Show Gender</button>
		<button id="button_2" onClick="displayAge()">Show Ages</button>
		<button id="button_3" onClick="clearStyle()">Clear</button>
		<div id="mapLegend"><strong>Map Legend</strong>
			<li style="color: black; padding-top: 10px;">Pump</li>
			<li style="color: #ff0033;">Death</li>
		</div>
		<div id="genderLegend"><strong>Gender Legend</strong>
			<li style="color: #03c6fc; padding-top: 10px;">Male</li>
			<li style="color: #e703fc;">Female</li>
		</div>
		<div id="ageLegend"><strong>Age Legend</strong>
			<li style="color: #1b9e77; padding-top: 10px;">0-10</li>
			<li style="color: #d95f02;">11-20</li>
			<li style="color: #7570b3;">21-40</li>
			<li style="color: #e7298a;">41-60</li>
			<li style="color: #66a61e">61-80</li>
			<li style="color: #e6ab02;">over 80</li>
			<svg width="600" height="500"></svg>
		</div>
	</div>
		

	
	<script>
		const choleraMap = d3.select(".choleraMap");
		const MAP_WIDTH = 500;
		const MAP_HEIGHT = 500;
		const minimum_death = 0;
		const deathCount = []
		var deaths = [];
		var deathDays = [];
		let deathGraph = d3.select(".graph");
		let graphWidth = 500;
		let graphHeight = 500;
		let svg_female = {};
		let svg = d3.select('body').append('svg.graph')
		var createLine = d3.svg.line()
		
		
    var streets = [];
		var pumps = [];
		let ages = [
			{
				age_range: '0-10',
				fill: '#1b9e77'
			},
			{
				age_range: '11-20',
				fill: '#d95f02'
			},
			{
				age_range: '21-40',
				fill: '#7570b3'
			},
			{
				age_range: '41-60',
				fill: '#e7298a'
			},
			{
				age_range: '61-80',
				fill: '#66a61e'
			},
			{
				age_range: '> 80',
				fill: '#e6ab02'
			}
		];
		
		let scaleX = d3.scale.linear();
		let scaleY = d3.scale.linear();
		let xScaleForGraph = d3.scale.linear();
		let yScaleForGraph = d3.scale.linear();
		

		scaleX.domain([3,20]).range([0, MAP_WIDTH]);
		scaleY.domain([3,20]).range([MAP_HEIGHT, 0]);

		function drawGraph() {
			let x = d3.svg.axis()
				.orient('bottom')
				.scale(xScaleForGraph)
				.tickFormat(function(d) {
					return deathDays[d].date;
				});

			let y = d3.svg.axis()
			.orient('left')
				.scale(yScaleForGraph)

			deathGraph.append('g')
				.attr('class', 'axis')
				.attr('transform', 'translate(0, 475)')
				.call(x);

			deathGraph.append('g')
				.attr('class', 'axis')
				.attr('transform', 'translate(30)')
				.call(y);
			}

	//Set up functions that will help create map
		const mapSetup = d3.svg.line()
			.x(function(d) { return scaleX(d.x); })
			.y(function(d) { return scaleY(d.y); })

	//Load deaths data and push the data into the deaths array that will be an object containing x and y values
    d3.csv("deaths_age_sex.csv", function(data) {
      for (let i=0; i < data.length; i++) {
        deaths.push(
          {
            x: data[i].x,
            y: data[i].y,
            age: +data[i].age,
						gender: data[i].gender == 0 ? "male" : "female",
						
          }
        );
      }
			
  // Load pump data and push it into the empty pump array to be read later in the function putting them on the map    
      });
    d3.csv("pumps.csv", function(data) {
      for (let i=0; i < data.length; i++) {
        pumps.push(
          {
            x: data[i].x,
            y: data[i].y,
            
          }
        );
      }
        
      });

		
	//Load streets data and use a for loop that will leverage map functions to add the streets
		d3.json("streets.json", function(data) {
			streets = data;
			
			for (let i=0; i < streets.length; i++) {
				choleraMap.append("path")
					.attr("d", mapSetup(streets[i]))
					.attr("id", "street");
			}
			addDeathsToMap();
			addPumpsToMap();
		});

	//Add circles to the map representing each death in the death array
    function addDeathsToMap() {
			choleraMap.selectAll('.death')
				.data(deaths)
				.enter()
				.append('circle')
				.attr('r', 3)
				.attr('id', 'death')
				.attr('class', function(d) {
					return " " +
						"age" + d.age + " " 
				})
				.attr('data-gender', function(d) {
					return "" +
						d.gender + ""
				})
				.attr('fill', '#FF0033')
				.attr('cx', function(d) { return scaleX(d.x); })
				.attr('cy', function(d) { return scaleY(d.y); })
				.on("mouseover", handleMouseOver)
				// .on("mouseout", handleMouseOut)
		}

		d3.json("streets.json", function(data) {
			streets = data;
			
			for (let i=0; i < streets.length; i++) {
				choleraMap.append("path")
					.attr("d", mapSetup(streets[i]))
					.attr("id", "street");
			}
			addDeathsToMap();
			addPumpsToMap();
			// drawDeathsGraph()
		});
    
	function addPumpsToMap() {
		choleraMap.selectAll('.pump')
				.data(pumps)
				.enter()
				.append('circle')
				.attr('r', 6)
				.attr('class', 'pump')
				.attr('fill', '#444444')
				.attr('cx', function(d) { return scaleX(d.x); })
				.attr('cy', function(d) { return scaleY(d.y); })
		}

		function handleMouseOver() {
			choleraMap.selectAll('.death')
     	.append('rect')
			 .attr('width', 10)
			 .attr('height', 10)
			 .attr('fill', )
		}

		choleraMap.append("text")
  			.attr("class", "streetName")
  			.attr("transform", "translate(150,200) rotate(-21)")
  			.text("Great Marlborough Street");

		choleraMap.append("text")
  			.attr("class", "streetName")
  			.attr("transform", "translate(150,115) rotate(-10)")
  			.text("Oxford Street");

		choleraMap.append("text")
  			.attr("class", "streetName")
  			.attr("transform", "translate(200,205) rotate(-10)")
  			.text("Workhouse");

		choleraMap.append("text")
  			.attr("class", "streetName")
  			.attr("transform", "translate(250,255) rotate(-25)")
				.attr("z-index", "1000")
  			.text("Broad Street");
		choleraMap.append("text")
  			.attr("id", "soho")
  			.attr("transform", "translate(400,155) rotate(-25)")
				.attr("z-index", "1000")
  			.text("SOHO");

		function showGender() {
			choleraMap.selectAll('[data-gender="male"]').attr('fill','#03c6fc');
			choleraMap.selectAll('[data-gender="female"]').attr('fill','#e703fc');
			createLine
				.x(function(d) { return xScaleForGraph(d.day); })
				.y(function(d) { return yScaleForGraph(d.male); });

			deathGraph.append('path')
				.attr('d', createLine(deathDays))
				.attr("class", "maleLineDeath")
			
			createLine
				.x(function(d) { return xScaleForGraph(d.day); })
				.y(function(d) { return yScaleForGraph(d.female); });

			deathGraph.append('path')
				.attr('d', createLine(deathDays))
				.attr("class", "femaleLineDeath")
			}	
		

		function clearStyle() {
				location.reload();
		}

		function displayAge() {
			for (let i=0; i < ages.length; i++) {
				choleraMap.selectAll('.age' + i)
					.attr('fill', ages[i].fill);
			}
			for (let i=0; i < ages.length; i++) {
				let createLine = d3.svg.line()
					.x(function(d) { return xScaleForGraph(d.day); })
					.y(function(d) { return yScaleForGraph(d.age[i]); });

				deathGraph.append('path')
					.attr('id', 'graphlineage' + i)
					.attr('d', createLine(deathDays));

					for (let i=0; i < ages.length; i++) {
						deathGraph.select('#graphlineage' + i)
					.attr('fill', ages[i].fill);

			}
		}
			}
		


		function drawDeath() {
				createLine
				.x(function(d) { return xScaleForGraph(d.day); })
				.y(function(d) { return yScaleForGraph(d.total); });

			deathGraph.append('path')
				.attr('d', createLine(deathDays))
				.on("mouseover", handleMouseOver)
			}	


		function drawGraph() {
		let x = d3.svg.axis()
			.orient('bottom')
			.scale(xScaleForGraph)
			.tickFormat(function(d) {
				return deathDays[d].date;
			});

		let y = d3.svg.axis()
		.orient('left')
			.scale(yScaleForGraph)

		deathGraph.append('g')
			.attr('class', 'axis')
			.attr('transform', 'translate(0, 475)')
			.call(x);

		deathGraph.append('g')
			.attr('class', 'axis')
			.attr('transform', 'translate(30)')
			.call(y);
		}

		d3.csv("deathdays.csv", function(data) {
		let deathId = 0;
		for (let day = 0; day < data.length; day++) {
			let totalCount = +data[day].deaths;
			let men = 0;
			let women = 0;
			let ageCount = [0,0,0,0,0,0];
			for (let i=0; i < totalCount; i++) {
				if (deaths[deathId].gender == "male") {
					men++;
				} else {
					women++;
				}
				ageCount[deaths[deathId].age]++;
				deathId++;
			}	
			deathDays.push ({
				day: day,
				date: data[day].date,
				total: totalCount,
				male: men,
				female: women,
				age: ageCount
			});
			
		}

		xScaleForGraph.domain([0, 41])
			.range([30, 500]);
			yScaleForGraph.domain([0, 160])
			.range([475, 10]);
			
		addDeathsToMap();
		drawDeath();
		drawGraph();
					
				});
	</script>
</body>


</html>
